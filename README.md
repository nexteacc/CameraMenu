# CameraMenu - èœå•ç¿»è¯‘åº”ç”¨

è¿™æ˜¯ä¸€ä¸ªåŸºäº Next.js (App Router) å¼€å‘çš„ç°ä»£åŒ– Web åº”ç”¨ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ‹æ‘„èœå•ç…§ç‰‡å¹¶å°†å…¶ç¿»è¯‘æˆä¸åŒè¯­è¨€ã€‚é¡¹ç›®é‡‡ç”¨äº† React å’Œ TypeScriptï¼Œå¹¶ä½¿ç”¨äº† Tailwind CSS è¿›è¡Œæ ·å¼è®¾è®¡ã€‚ç”¨æˆ·è®¤è¯é€šè¿‡ Clerk å®ç°ã€‚

## é¡¹ç›®æ¶æ„

é¡¹ç›®é‡‡ç”¨äº† Next.js çš„ App Router æ¶æ„ï¼Œä¸»è¦æ–‡ä»¶å’Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

-   `/app` - åŒ…å«åº”ç”¨çš„ä¸»è¦é¡µé¢ã€APIè·¯ç”±å’Œå¸ƒå±€ã€‚
    -   `/app/api` - åç«¯ API æ¥å£ï¼ŒåŒ…æ‹¬å›¾ç‰‡ä¸Šä¼  (`/upload`) å’Œä»»åŠ¡çŠ¶æ€æŸ¥è¯¢ (`/task/[taskId]`)ã€‚
    -   `/app/page.tsx` - åº”ç”¨ä¸»é¡µé¢ï¼Œå¤„ç†ç›¸æœºäº¤äº’ã€çŠ¶æ€ç®¡ç†å’ŒAPIè°ƒç”¨ã€‚
    -   `/app/layout.tsx` - åº”ç”¨çš„æ ¹å¸ƒå±€ã€‚
-   `/components` - åŒ…å«å¯å¤ç”¨çš„ UI ç»„ä»¶ã€‚
    -   `CameraView.tsx` - ç›¸æœºé¢„è§ˆå’Œæ‹ç…§ç»„ä»¶ã€‚
    -   `ResultsView.tsx` - å±•ç¤ºç¿»è¯‘ç»“æœï¼ˆPDFæ ¼å¼ï¼‰çš„ç»„ä»¶ï¼Œæ”¯æŒæ‰‹åŠ¿ç¼©æ”¾ã€‚
    -   `LanguageSelector.tsx` - è¯­è¨€é€‰æ‹©ç»„ä»¶ã€‚
    -   `CameraButton.tsx` - å¯åŠ¨ç›¸æœºçš„æŒ‰é’®ã€‚
    -   `AuroraBackground.tsx` - ç¾è§‚çš„èƒŒæ™¯ç»„ä»¶ã€‚
-   `/lib` - åŒ…å«å·¥å…·å‡½æ•° (ä¾‹å¦‚ `utils.ts`)ã€‚
-   `/public` - åŒ…å«é™æ€èµ„æº (ä¾‹å¦‚ `pdf.worker.min.js` å¦‚æœæœ¬åœ°æ‰˜ç®¡)ã€‚

## æ ¸å¿ƒåŠŸèƒ½

1.  **ç”¨æˆ·è®¤è¯**ï¼šä½¿ç”¨ Clerk è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œä¿æŠ¤APIæ¥å£ã€‚
2.  **ç›¸æœºæ‹ç…§**ï¼šé€šè¿‡æµè§ˆå™¨çš„ MediaDevices API è®¿é—®è®¾å¤‡ç›¸æœºï¼Œæ‹æ‘„èœå•ç…§ç‰‡ã€‚
3.  **å›¾ç‰‡ä¸Šä¼ ä¸ç¿»è¯‘ä»»åŠ¡åˆ›å»º**ï¼šå°†æ‹æ‘„çš„èœå•ç…§ç‰‡å’Œç›®æ ‡è¯­è¨€ä¸Šä¼ åˆ°åç«¯ `/api/upload` æ¥å£ï¼Œåç«¯è°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡è¿›è¡ŒOCRå’Œç¿»è¯‘ï¼Œå¹¶è¿”å›ä»»åŠ¡IDã€‚
4.  **å¼‚æ­¥ä»»åŠ¡è½®è¯¢ä¸ç»“æœè·å–**ï¼šå‰ç«¯é€šè¿‡è½®è¯¢ `/api/task/[taskId]` æ¥å£è·å–ç¿»è¯‘ä»»åŠ¡çš„çŠ¶æ€å’Œæœ€ç»ˆçš„ç¿»è¯‘ç»“æœURLï¼ˆPDFæ ¼å¼ï¼‰ã€‚
5.  **PDFç»“æœå±•ç¤ºä¸äº¤äº’**ï¼šåœ¨ `ResultsView.tsx` ç»„ä»¶ä¸­ä½¿ç”¨ `react-pdf` å±•ç¤ºç¿»è¯‘åçš„PDFæ–‡ä»¶ï¼Œæ”¯æŒåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šé€šè¿‡åŒæŒ‡æ‰‹åŠ¿è¿›è¡Œç¼©æ”¾ï¼Œåœ¨æ¡Œé¢è®¾å¤‡ä¸Šé€šè¿‡é¼ æ ‡æ»šè½®ç¼©æ”¾ã€‚
6.  **åŒè¯­è¨€é€‰æ‹©æ”¯æŒ**ï¼šç”¨æˆ·å¯ä»¥é€‰æ‹©æºè¯­è¨€å’Œç›®æ ‡ç¿»è¯‘è¯­è¨€ï¼Œæ”¯æŒ Englishã€Vietnameseã€Simplified Chinese ä¸‰ç§è¯­è¨€ã€‚

## å·¥ä½œæµç¨‹

1.  ç”¨æˆ·é€šè¿‡ Clerk ç™»å½•åº”ç”¨ã€‚
2.  åœ¨ä¸»é¡µé¢ (`page.tsx`)ï¼Œç”¨æˆ·é€‰æ‹©æºè¯­è¨€å’Œç›®æ ‡ç¿»è¯‘è¯­è¨€ã€‚
3.  ç”¨æˆ·ç‚¹å‡»æ‹ç…§æŒ‰é’®ï¼Œæ¿€æ´» `CameraView.tsx`ã€‚
4.  ç”¨æˆ·æ‹æ‘„èœå•ç…§ç‰‡å¹¶ç¡®è®¤ã€‚
5.  `page.tsx` ä¸­çš„ `handleCapture` å‡½æ•°å°†å›¾ç‰‡æ•°æ® (Blob)ã€æºè¯­è¨€å’Œç›®æ ‡è¯­è¨€é€šè¿‡ FormData ä¸Šä¼ åˆ° `/api/upload`ã€‚
6.  `/api/upload` (åœ¨ `app/api/upload/route.ts`) æ¥æ”¶è¯·æ±‚ï¼Œè¿›è¡ŒTokenéªŒè¯ï¼Œç„¶åè°ƒç”¨ç¬¬ä¸‰æ–¹ç¿»è¯‘æœåŠ¡åˆ›å»ºç¿»è¯‘ä»»åŠ¡ï¼Œå¹¶è¿”å› `taskId` å’Œ`status`ã€‚
7.  `page.tsx` æ¥æ”¶åˆ° `taskId` åï¼Œå¯åŠ¨ `pollTranslationResult` å‡½æ•°ï¼Œè¯¥å‡½æ•°å®šæœŸè°ƒç”¨ `/api/task/[taskId]`ã€‚
8.  `/api/task/[taskId]` (åœ¨ `app/api/task/[taskId]/route.ts`) æŸ¥è¯¢ç¬¬ä¸‰æ–¹æœåŠ¡çš„ä»»åŠ¡çŠ¶æ€å’Œç»“æœã€‚
9.  è½®è¯¢ç›´åˆ°ä»»åŠ¡å®Œæˆï¼ˆ`status === 'Completed'`ï¼‰å¹¶ä¸”è·å–åˆ° `translatedFileUrl` (PDFé“¾æ¥)ï¼Œæˆ–è€…ä»»åŠ¡å¤±è´¥ã€‚
10. `page.tsx` æ›´æ–°çŠ¶æ€ï¼Œå¹¶å°† `translatedFileUrl` å’Œå…¶ä»–ç›¸å…³ä¿¡æ¯ä¼ é€’ç»™ `ResultsView.tsx`ã€‚
11. `ResultsView.tsx` ä½¿ç”¨ `react-pdf` åŠ è½½å¹¶æ˜¾ç¤ºPDFï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æ‰‹åŠ¿æˆ–æ»šè½®è¿›è¡Œç¼©æ”¾ã€‚
12. ç”¨æˆ·å¯ä»¥è¿›è¡Œé‡æ‹ã€è¿”å›æˆ–é‡è¯•æ“ä½œã€‚

## æ•°æ®æµç¨‹è¯¦è§£

### ğŸ“¸ å›¾ç‰‡æ•°æ®æµè½¬è·¯å¾„

**ä¼˜åŒ–åçš„æ•°æ®æµç¨‹ï¼ˆv2.0ï¼‰**ï¼š

1. **ç›¸æœºæ•è·é˜¶æ®µ**ï¼š
   - `CameraView.tsx` â†’ Canvasç»˜åˆ¶ â†’ `canvas.toBlob()` â†’ JPEGæ ¼å¼Blobå¯¹è±¡

2. **å‰ç«¯ä¸Šä¼ é˜¶æ®µ**ï¼š
   - `page.tsx` â†’ åˆ›å»ºFormData â†’ æ·»åŠ image(Blob)ã€fromLangã€toLangã€userId â†’ `fetch('/api/upload')`

3. **åç«¯è½¬å‘é˜¶æ®µ**ï¼ˆå…³é”®ä¼˜åŒ–ï¼‰ï¼š
   - `route.ts` â†’ æ¥æ”¶FormData â†’ ç›´æ¥åˆ›å»ºæ–°FormData â†’ æ·»åŠ `shouldTranslateImage: 'true'` â†’ è½¬å‘ç»™ç¬¬ä¸‰æ–¹API
   - **æ ¼å¼**ï¼š`multipart/form-data`ï¼ˆç¬¦åˆAPIè¦æ±‚ï¼‰
   - **å…³é”®å‚æ•°**ï¼š`shouldTranslateImage: 'true'` å¯ç”¨å›¾ç‰‡OCRç¿»è¯‘

4. **APIå“åº”é˜¶æ®µ**ï¼š
   - ç¬¬ä¸‰æ–¹API â†’ è¿”å›taskId â†’ å‰ç«¯å¼€å§‹è½®è¯¢ â†’ æœ€ç»ˆè·å¾—`translatedFileUrl`ï¼ˆPDFæ–‡æ¡£é“¾æ¥ï¼‰

5. **ç»“æœå±•ç¤ºé˜¶æ®µ**ï¼š
   - `ResultsView.tsx` â†’ ä½¿ç”¨`react-pdf`æ¸²æŸ“PDF â†’ æ”¯æŒç¼©æ”¾å’Œäº¤äº’



## æ•°æ®æµè½¬ä¸çŠ¶æ€ç®¡ç†

-   **ä¸»è¦çŠ¶æ€ç®¡ç†**ï¼šåœ¨ `app/page.tsx` ä¸­ä½¿ç”¨ `useState` ç®¡ç†åº”ç”¨çš„æ ¸å¿ƒçŠ¶æ€ï¼ŒåŒ…æ‹¬ç›¸æœºæ¿€æ´»çŠ¶æ€ã€æ‹æ‘„çš„å›¾ç‰‡ã€æºè¯­è¨€ã€ç›®æ ‡è¯­è¨€ã€ä»»åŠ¡IDã€ä»»åŠ¡çŠ¶æ€ã€ç¿»è¯‘è¿›åº¦ã€ç¿»è¯‘ç»“æœURLå’Œé”™è¯¯ä¿¡æ¯ã€‚
-   **ç¿»è¯‘çŠ¶æ€ç±»å‹**ï¼šå®šä¹‰äº† `TranslationStatus` ç±»å‹ï¼ŒåŒ…å«ä»¥ä¸‹çŠ¶æ€ï¼š
    *   `Analyzing` - åˆå§‹åˆ†æé˜¶æ®µ
    *   `Waiting` - æ’é˜Ÿç­‰å¾…ä¸­
    *   `Processing` - æ­£åœ¨ç¿»è¯‘
    *   `Completed` - ç¿»è¯‘å®Œæˆ
    *   `Terminated` - ç¿»è¯‘å¤±è´¥/ç»ˆæ­¢
    *   `NotSupported` - ä¸æ”¯æŒçš„å†…å®¹
-   **Token è·å–**ï¼šé€šè¿‡ `useAuth` (Clerk) è·å–ç”¨æˆ·ä¼šè¯Tokenï¼Œç”¨äºAPIè¯·æ±‚è®¤è¯ã€‚
-   **API é€šä¿¡**ï¼š
    *   å›¾ç‰‡ä¸Šä¼ ï¼š`POST /api/upload` (FormData)
    *   ç»“æœè½®è¯¢ï¼š`GET /api/task/[taskId]`
-   **Props ä¼ é€’**ï¼šçŠ¶æ€å’Œå›è°ƒå‡½æ•°é€šè¿‡ props ä» `page.tsx` ä¼ é€’åˆ°å­ç»„ä»¶å¦‚ `CameraView.tsx` å’Œ `ResultsView.tsx`ã€‚



## API æ¥å£è¯´æ˜

### 1. `/api/upload`

-   **æ–¹æ³•**: `POST`
-   **Content-Type**: `multipart/form-data`
-   **è®¤è¯**: éœ€è¦ Clerk Session Token (Bearer Token in Authorization header)
-   **è¯·æ±‚ä½“å‚æ•°**:
    -   `image`: (File) æ‹æ‘„çš„å›¾ç‰‡æ–‡ä»¶ã€‚
    -   `toLang`: (String) ç›®æ ‡ç¿»è¯‘è¯­è¨€åç§°ï¼ˆå¦‚ "English", "Vietnamese", "Simplified Chinese"ï¼‰ã€‚
    -   `fromLang`: (String) æºè¯­è¨€åç§°ï¼ˆå¿…éœ€å‚æ•°ï¼‰ã€‚
    -   `userId`: (String) ç”¨æˆ·IDï¼ˆå¿…éœ€å‚æ•°ï¼‰ã€‚
-   **å†…éƒ¨å¤„ç†**: åç«¯ç›´æ¥è½¬å‘FormDataåˆ°ç¬¬ä¸‰æ–¹APIï¼Œè‡ªåŠ¨æ·»åŠ  `shouldTranslateImage: 'true'` å‚æ•°å¯ç”¨OCRç¿»è¯‘ã€‚
-   **æˆåŠŸå“åº” (200 OK)**:
    ```json
    {
      "taskId": "some-task-id",
      "status": "Pending" // æˆ–å…¶ä»–åˆå§‹çŠ¶æ€
    }
    ```
-   **é”™è¯¯å“åº”**: æ ‡å‡† HTTP é”™è¯¯ç  (å¦‚ 400, 401, 500) åŠé”™è¯¯ä¿¡æ¯ã€‚

### 2. `/api/task/[taskId]`

-   **æ–¹æ³•**: `GET`
-   **è®¤è¯**: éœ€è¦ Clerk Session Token (Bearer Token in Authorization header)
-   **è·¯å¾„å‚æ•°**:
    -   `taskId`: (String) ç”± `/api/upload` è¿”å›çš„ä»»åŠ¡IDã€‚
-   **æˆåŠŸå“åº” (200 OK)**:
    ```json
    {
      "taskId": "some-task-id",
      "status": "Completed", // "Processing", "Failed", etc.
      "progress": 100,
      "translatedFileUrl": "url-to-translated-pdf.pdf", // çŠ¶æ€ä¸º Completed æ—¶å‡ºç°
      "error": null // æˆ–é”™è¯¯ä¿¡æ¯å­—ç¬¦ä¸²
    }
    ```
-   **é”™è¯¯å“åº”**: æ ‡å‡† HTTP é”™è¯¯ç  (å¦‚ 401, 404, 500) åŠé”™è¯¯ä¿¡æ¯ã€‚

## å¼€å‘ä¸è¿è¡Œ

```bash
# å®‰è£…ä¾èµ– (é¡¹ç›®ä½¿ç”¨ pnpm)
pnpm install

# å¼€å‘æ¨¡å¼è¿è¡Œ (ä½¿ç”¨ Turbopack åŠ é€Ÿ)
pnpm dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm build

# è¿è¡Œç”Ÿäº§ç‰ˆæœ¬
pnpm start
```

## ç¯å¢ƒå˜é‡

é¡¹ç›®éœ€è¦ä»¥ä¸‹ç¯å¢ƒå˜é‡ (é€šå¸¸åœ¨ `.env.local` æ–‡ä»¶ä¸­é…ç½®):

-   `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`: Clerk çš„å¯å‘å¸ƒå¯†é’¥ã€‚
-   `CLERK_SECRET_KEY`: Clerk çš„ç§˜å¯†å¯†é’¥ (ç”¨äºåç«¯éªŒè¯)ã€‚
-   `TRANSLATION_API_KEY`: ç¬¬ä¸‰æ–¹ç¿»è¯‘æœåŠ¡çš„ API å¯†é’¥ã€‚


